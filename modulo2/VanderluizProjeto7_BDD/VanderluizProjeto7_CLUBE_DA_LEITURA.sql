/*1-CRIAÇÃO DO BANCO DE DADOS CLUBE_DA_LEITURA*/
CREATE DATABASE CLUBE_DA_LEITURA;

USE CLUBE_DA_LEITURA
CREATE TABLE REVISTA(
    ID INT IDENTITY(1,1) NOT NULL,
    EDICAO BIGINT NOT NULL,
    TIPO_COLECAO NVARCHAR(100) NOT NULL,
    ANO_REVISTA DATETIME NOT NULL,
    COR_CAIXA NVARCHAR(30),
    CONSTRAINT PK_REVISTA PRIMARY KEY (ID) 
);

CREATE TABLE AMIGO(
    NOME NVARCHAR(255) NOT NULL,
    NOME_MAE NVARCHAR(255) NOT NULL,
    TELEFONE BIGINT NOT NULL,
    DE_ONDE_CONHECE NVARCHAR(100) NOT NULL,
    CONSTRAINT PK_AMIGO PRIMARY KEY (NOME)
);

CREATE TABLE EMPRESTIMO(
    ID INT IDENTITY(1,1) NOT NULL,
    AMIGO_EMPRESTIMO NVARCHAR(255) NOT NULL,
    ID_REVISTA INT NOT NULL,
    DATA_EMPRESTIMO DATETIME NOT NULL,
    DATA_DEVOLUCAO DATETIME NOT NULL,
    PRECO FLOAT NOT NULL,
    CONSTRAINT PK_EMPRESTIMO PRIMARY KEY (ID),
    CONSTRAINT FK_REVISTA FOREIGN KEY (ID_REVISTA) REFERENCES REVISTA (ID),
    CONSTRAINT FK_AMIGO FOREIGN KEY (AMIGO_EMPRESTIMO) REFERENCES AMIGO (NOME)    
);

/*2-INSERSÃO DE DADOS*/
USE CLUBE_DA_LEITURA
INSERT AMIGO
VALUES ('CARLOS', 'JOANA', 32252233, 'ESCOLA'), 
       ('TIAGO', 'JOANA', 32252233, 'ESCOLA'),
       ('PEDRO', 'ANA', 32232213, 'SHOPPING'),
       ('ANTONIO', 'ANA PAULA', 32232553, 'SHOPPING'),
       ('PAULO', 'MARIA', 32211233, 'PARQUE'),
       ('IGOR', 'ANDREIA', 31252443, 'PARQUE');

USE CLUBE_DA_LEITURA
INSERT REVISTA
VALUES (30, 'BATMAN', '2002', 'PRETO'), 
       (27, 'BATMAN DO FUTURO', '2012', 'PRETO'), 
       (37, 'BATMAN RENASCIMENTO', '2020', 'PRETO'), 
       (1, 'BATMAN - A PIADA MORTAL ', '2022', 'PRETO'), 
       (3, 'O BATMAN QUE RI ', '2020', 'PRETO'), 
       (3, 'WOLVERINE - ORIGEM', '2018', 'AMARELO'), 
       (1, 'WOLVERINE - INIMIGO DO ESTADO ', '2018', 'AMARELO'), 
       (1, 'O VELHO LOGAN', '2019', 'AMARELO'), 
       (1, 'KING SPAWN ', '2022', 'VERMELHO'), 
       (1, 'Spawn Compendium ', '2021', 'PRETO');
       
USE CLUBE_DA_LEITURA
INSERT EMPRESTIMO
VALUES ('CARLOS', 1, '05-08-2022', '12-08-2022', 1.10), 
       ('TIAGO', 2, '05-08-2022', '12-08-2022', 1.10),
       ('PEDRO', 3, '05-08-2022', '12-08-2022', 1.10),
       ('ANTONIO', 4, '05-08-2022', '12-08-2022', 1.10),
       ('PAULO', 5, '05-08-2022', '12-08-2022', 1.10),
       ('IGOR', 6, '05-08-2022', '12-08-2022', 1.10),
       ('PEDRO', 7, '05-08-2022', '12-08-2022', 1.10),
       ('ANTONIO', 8, '05-08-2022', '12-08-2022', 1.10),
       ('PAULO', 9, '05-08-2022', '12-08-2022', 1.10),
       ('IGOR', 10, '05-08-2022', '12-08-2022', 1.10);
       
       
/*3- UPDATE DE VALORES*/
UPDATE EMPRESTIMO
SET PRECO = '18.25'
WHERE ID = 1;
UPDATE EMPRESTIMO
SET PRECO = '15.25'
WHERE ID = 2;
UPDATE EMPRESTIMO
SET PRECO = '11.25'
WHERE ID = 3;
UPDATE EMPRESTIMO
SET PRECO = '12.25'
WHERE ID = 4;
UPDATE EMPRESTIMO
SET PRECO = '14.25'
WHERE ID = 5;
UPDATE EMPRESTIMO
SET PRECO = '15.25'
WHERE ID = 6;
UPDATE EMPRESTIMO
SET PRECO = '17.25'
WHERE ID = 7;
UPDATE EMPRESTIMO
SET PRECO = '21.25'
WHERE ID = 8;
UPDATE EMPRESTIMO
SET PRECO = '8.25'
WHERE ID = 9;
UPDATE EMPRESTIMO
SET PRECO = '5.25'
WHERE ID = 10;

/*4 - EMPRESTIMOS COM VALOR ENTRE 12.00 E 16.00*/
SELECT EMPRESTIMO.ID, EMPRESTIMO.DATA_DEVOLUCAO, EMPRESTIMO.AMIGO_EMPRESTIMO, EMPRESTIMO.PRECO
FROM EMPRESTIMO
WHERE EMPRESTIMO.PRECO >= 12.00 AND EMPRESTIMO.PRECO <= 16.00

/*5 - SELECIONA AS REVISTAS DAS COLEÇÕES ESPECIFICADAS */
SELECT * FROM REVISTA WHERE TIPO_COLECAO LIKE '%BATMAN%'
SELECT * FROM REVISTA WHERE TIPO_COLECAO LIKE '%SPAWN%'


/*6 - NOMES COM A*/
SELECT AMIGO.NOME AS 'TEM A'
FROM AMIGO
WHERE NOME LIKE '%A%'

SELECT AMIGO.NOME AS 'COMEÇA COM A'
FROM AMIGO
WHERE NOME LIKE 'A%'

SELECT AMIGO.NOME AS 'TERMINA COM A'
FROM AMIGO
WHERE NOME LIKE '%A' 

/*7 - MEDIA DE PRECO, LUCRO DOS PREÇOS, MAIOR E MENOR PRECO*/
SELECT AVG(PRECO) AS [MEDIA DE PRECO]
FROM EMPRESTIMO

SELECT SUM(PRECO) AS [LUCRO POR SEMANA]
FROM EMPRESTIMO

SELECT MAX(PRECO) AS [MAIOR PRECO]
FROM EMPRESTIMO

SELECT MIN(PRECO) AS [MENOR PRECO]
FROM EMPRESTIMO

/*8 - TOTAL DE AMIGOS, REVISTAS E EMPRESTIMOS CADASTRADOS*/
SELECT COUNT(*) AS [TOTAL DE AMIGOS]
FROM AMIGO
GO
SELECT COUNT(*) AS [TOTAL DE REVISTAS]
FROM REVISTA
GO
SELECT COUNT(*) AS [TOTAL DE EMPRESTIMO]
FROM EMPRESTIMO
GO

/*9 - */
SELECT *  
FROM EMPRESTIMO ORDER BY DATA_DEVOLUCAO;

/*10 - DELETANDO OS DADOS DAS TABELAS*/
DELETE FROM AMIGO;
DELETE FROM REVISTA;
DELETE FROM EMPRESTIMO;

/*10.1 - RESET DO IDENTITY DE REVISTA PARA 1*/
USE CLUBE_DA_LEITURA;
GO
TRUNCATE TABLE REVISTA;
GO
DBCC CHECKIDENT('REVISTA', RESEED, 1);
GO

/*10.2 - RESET DO IDENTITY DE EMPRESTIMO PARA 1*/
USE CLUBE_DA_LEITURA;
GO
TRUNCATE TABLE EMPRESTIMO;
GO
DBCC CHECKIDENT('EMPRESTIMO', RESEED, 1);
GO
 
    


